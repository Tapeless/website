{% extends "layout.html" %}
{% block title %}{{ obj_name }}{% endblock %}
{% block head %}
{% endblock %}
{% block content %}
<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.127.0/build/three.module.js';
  import { OrbitControls } from "https://unpkg.com/three@0.127.0/examples/jsm/controls/OrbitControls.js";
  import { OBJLoader } from "https://unpkg.com/three@0.127.0/examples/jsm/loaders/OBJLoader.js";
  import { MTLLoader } from "https://unpkg.com/three@0.127.0/examples/jsm/loaders/MTLLoader.js";


  let scene, camera, renderer, controls;

  function init() {
      const container = document.getElementById('threejs-container');
      const width = container.offsetWidth;
      const height = container.offsetHeight;
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
      camera.position.z = 0.70;
      camera.position.y = 0.40;

      renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setSize(width, height);
      container.appendChild(renderer.domElement);

      // Lighting
      scene.background = new THREE.Color(0x272822);
      const ambientLight = new THREE.AmbientLight(0xFFFFFF); // soft white light
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
      scene.add(directionalLight);

      // Controls
      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.25;
      controls.enableZoom = true;

      // MTLLoader and OBJLoader integration
      const mtlLoader = new MTLLoader();
      //mtlLoader.setTexturePath("{{ url_for('static', filename='objects/') }}"); // Path to where your textures are located
      //mtlLoader.setPath("{{ url_for('static', filename='objects/') }}"); // Path to where your MTL and OBJ files are located
      const basePath = "{{ url_for('static', filename='objects/') }}"
      mtlLoader.load(basePath+'{{ mtl }}', function (materials) {
          materials.preload();

          const objLoader = new OBJLoader();
          objLoader.setMaterials(materials);
          objLoader.setPath("{{ url_for('static', filename='objects/') }}");
          objLoader.load('{{ obj }}', function (object) {
              scene.add(object);
          });
      });
  }

  function animate() {
      requestAnimationFrame(animate);
      if (controls) {
          controls.update();
      }        
      renderer.render(scene, camera);
  }

  function onWindowResize() {
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
  }

  init();

  window.addEventListener('resize', onWindowResize, false);

  animate();
</script>
<h2>{{ obj_name }}</h2>
<div id="threejs-container" class="threejs-container"></div>
{% endblock %}